<script>
  String.prototype.format = function() {
    a = this;
    for (k in arguments) {
      a = a.replace('{' + k + '}', arguments[k])
    }
    return a
  }

  $(document).ready(function() {
    let submitButton = $('#id_submit_button');
    submitButton.click((e) => {
      e.preventDefault();
      let selectedOptTypeText = $('#id_operation_type option:selected').text();
      let loweredSelectedOptionText = selectedOptTypeText.toLowerCase();
      let additionalMessage = ""
      if (loweredSelectedOptionText.includes('delete')) {
        additionalMessage = "</br>The data you request will be DELETED PERMANENTLY.</br><b>You cannot undo this action</b>."
      }
      let batchName = $('#id_batch_name').val()
      let modalBody = 'Are you sure to execute <b>"{0}"</b> on <b>"{1}"</b>?{2}'.format(selectedOptTypeText, batchName, additionalMessage)
      $('#id_confirmation_modal_body').html(modalBody)
    })

    let confirmationModal = $('#id_confirmation_modal');
    let confirmationButton = $('#id_confirmation_button');
    confirmationModal.on('shown.bs.modal', () => {
      confirmationButton.focus();
    })

    let switchDangerousOperations = $('#switchSpecialOperations');
    let switchableOptionValues = $('.switchable');
    switchDangerousOperations.change(function() {
      switchableOptionValues.toggleClass('d-none');
    });
  })
</script>
